<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.5.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Dominic Magirr">

  
  
  
    
  
  <meta name="description" content="Motivation I don’t understand the details of concordance in survival analysis, so I’m trying to explain it to myself.
Probabilistic index I recently read the very nice paper On the interpretation of the hazard ratio in Cox regression by Jan De Neve and Thomas Gerds.
Suppose in the context of a clinical trial we use a Cox model to compare an experimental treatment (A=1) with a control treatment (A=0), where (for simplicity here) treatment is the only term in the model (assume the model is correct, by the way).">

  
  <link rel="alternate" hreflang="en-us" href="/post/2021-12-14-notes-on-concordance/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/2021-12-14-notes-on-concordance/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Dominic Magirr">
  <meta property="og:url" content="/post/2021-12-14-notes-on-concordance/">
  <meta property="og:title" content="Notes on concordance | Dominic Magirr">
  <meta property="og:description" content="Motivation I don’t understand the details of concordance in survival analysis, so I’m trying to explain it to myself.
Probabilistic index I recently read the very nice paper On the interpretation of the hazard ratio in Cox regression by Jan De Neve and Thomas Gerds.
Suppose in the context of a clinical trial we use a Cox model to compare an experimental treatment (A=1) with a control treatment (A=0), where (for simplicity here) treatment is the only term in the model (assume the model is correct, by the way)."><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2021-12-14T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2021-12-14T15:03:20&#43;00:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/2021-12-14-notes-on-concordance/"
  },
  "headline": "Notes on concordance",
  
  "datePublished": "2021-12-14T00:00:00Z",
  "dateModified": "2021-12-14T15:03:20Z",
  
  "author": {
    "@type": "Person",
    "name": "Dominic Magirr"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Dominic Magirr",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "Motivation I don’t understand the details of concordance in survival analysis, so I’m trying to explain it to myself.\nProbabilistic index I recently read the very nice paper On the interpretation of the hazard ratio in Cox regression by Jan De Neve and Thomas Gerds.\nSuppose in the context of a clinical trial we use a Cox model to compare an experimental treatment (A=1) with a control treatment (A=0), where (for simplicity here) treatment is the only term in the model (assume the model is correct, by the way)."
}
</script>

  

  


  


  





  <title>Notes on concordance | Dominic Magirr</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Dominic Magirr</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Notes on concordance</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Dec 14, 2021
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    16 min read
  </span>
  

  
  
  

  
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>I don’t understand the details of concordance in survival analysis, so I’m trying to explain it to myself.</p>
</div>
<div id="probabilistic-index" class="section level2">
<h2>Probabilistic index</h2>
<p>I recently read the very nice paper <a href="https://onlinelibrary.wiley.com/doi/full/10.1002/bimj.201800255">On the interpretation of the hazard ratio in Cox regression</a> by Jan De Neve and Thomas Gerds.</p>
<p>Suppose in the context of a clinical trial we use a Cox model to compare an experimental treatment (A=1) with a control treatment (A=0), where (for simplicity here) treatment is the only term in the model (assume the model is correct, by the way). Let <span class="math inline">\(\theta\)</span> denote the hazard ratio.</p>
<p>De Neve and Gerds recommend interpreting the treatment effect as a <em>probabilistic index</em>, that is, the probability that a randomly chosen patient on the experimental arm has a survival time (<span class="math inline">\(T_{1,j}\)</span>) that is longer than the survival time (<span class="math inline">\(T_{0,i}\)</span>) for a randomly chosen patient on the control arm . They show that:</p>
<p><span class="math display">\[P(T_{0,i} &lt; T_{1,j}) = \frac{1}{1 + \theta}.\]</span></p>
<p>That’s a super interesting relationship. However, they only show a proof for uncensored data. How should we interpret the probabilistic index in a trial with a maximum follow-up time and administrative right censoring (i.e. almost every trial)?</p>
<p>In their discussion, De Neve and Gerds say that we must assume proportional hazards also holds after the maximum follow up time. This suggests that when interpreting <span class="math inline">\(P(T_{0,i} &lt; T_{1,j})\)</span>, we are indeed thinking about an infinite follow-up.</p>
<p>This makes me slightly uncomfortable. We can check (to some extent) whether proportional hazards looks like a reasonable assumption for the duration of the study. Assuming it continues to hold until all patients have had their event is a bit more of a stretch. It got me wondering: does the following relationship still hold:</p>
<p><span class="math display">\[P(T_{0,i} &lt; T_{1,j} \mid \text{It&#39;s possible to know given censoring}) = \frac{1}{1 + \theta}?\]</span></p>
<p>How can I formulate that a bit more precisely? Denote the censoring times for patients <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> as <span class="math inline">\(C_{0,i}\)</span> and <span class="math inline">\(C_{1,j}\)</span> (and assume, by the way, that censoring and survival distributions are independent). In order to know for sure whether or not <span class="math inline">\(T_{0,i} &lt; T_{1,j}\)</span>, I need the minimum of <span class="math inline">\(T_{1,j}\)</span> and <span class="math inline">\(T_{0,i}\)</span> to be uncensored. Also, if the maximum of <span class="math inline">\(T_{1,j}\)</span> and <span class="math inline">\(T_{0,i}\)</span> is censored, I at least need the censoring time to come after the minimum of <span class="math inline">\(T_{1,j}\)</span> and <span class="math inline">\(T_{0,i}\)</span>. So, having picked two patients at random, in order to establish who has the better survival time I need <span class="math inline">\(\min\{T_{0,i},T_{1,j}\} &lt; \min\{C_{0,i}, C_{1,j} \}\)</span>. My question becomes: does</p>
<p><span class="math display">\[P(T_{0,i} &lt; T_{1,j} \mid \min\{T_{0,i},T_{1,j}\} &lt; \min\{C_{0,i}, C_{1,j} \} ) = \frac{1}{1 + \theta}?\]</span></p>
<p>Is the answer obvious? I have a bad feeling it might be and I’m about to do some unnecessary, tedious maths. I’ll condition on the censoring times. Let <span class="math inline">\(\tau:= \min\{C_{0,i}, C_{1,j}\}\)</span>. I’m interested in</p>
<p><span class="math display">\[
\begin{aligned}
 P(T_{0,i} &lt; T_{1,j} \mid \min\{T_{0,i},T_{1,j}\} &lt; \tau )  &amp; = P(T_{0,i} &lt; T_{1,j} \mid T_{0,i} &lt; \tau \cup T_{1,j} &lt; \tau ) \\
   &amp; = \frac{P(T_{0,i} &lt; T_{1,j} \cap T_{0,i} &lt; \tau )}{ P( T_{0,i} &lt; \tau \cup T_{1,j} &lt; \tau )} \\
\end{aligned}
\]</span></p>
<p>where I have used the fact that if <span class="math inline">\(T_{1,j} &lt; \tau\)</span> but <span class="math inline">\(T_{0,j} &gt; \tau\)</span>, then it is impossible for <span class="math inline">\(T_{0,i} &lt; T_{1,j}\)</span>. Starting with the numerator, I apply the survival distribution <span class="math inline">\(S_1\)</span> to everything:</p>
<p><span class="math display">\[
\begin{aligned}
  P(T_{0,i} &lt; T_{1,j} \cap T_{0,i} &lt; \tau )&amp; =  P(S_1(T_{0,i}) &gt; S_1(T_{1,j}) \cap S_1(T_{0,i}) &gt; S_1(\tau) )\\
   &amp;=   P(S_0(T_{0,i})^\theta &gt; S_1(T_{1,j}) \cap S_0(T_{0,i})^\theta &gt; S_1(\tau) )\\
   &amp;= P(U_0^\theta &gt; U_1 \cap U_0 &gt; u_*^{1/\theta} )
\end{aligned}
\]</span>
where I have used proportional hazards, <span class="math inline">\(S_1(t)=S_0(t)^\theta\)</span> for <span class="math inline">\(t \in (0,\tau)\)</span>, and defined <span class="math inline">\(U_0 = S_0(T_{0,i})\)</span>, <span class="math inline">\(U_1 = S_1(T_{1,i})\)</span>, and <span class="math inline">\(u_*=S_1(\tau)\)</span>. Since <span class="math inline">\(U_0\)</span> and <span class="math inline">\(U_1\)</span> are independent uniform, we have</p>
<p><span class="math display">\[
\begin{aligned}
P(U_0^\theta &gt; U_1 \cap U_0 &gt; u_*^{1/\theta} ) &amp;= \int_{u_*^{1/\theta}}^1 u_0^\theta du_0 \\
                                               &amp;= \left[  \frac{u_0^{\theta+1}}{\theta+1} \right]_{u_*^{1/\theta}}^1 \\
                                               &amp;= \frac{1 - u_*^{1+\frac{1}{\theta}}}{\theta + 1}
\end{aligned}
\]</span></p>
<p>Similarly for the denominator,
<span class="math display">\[
\begin{aligned}
 P( T_{0,i} &lt; \tau \cup T_{1,j} &lt; \tau )&amp; =  P( S_1(T_{0,i}) &gt; S_1(\tau) \cup S_1(T_{1,j}) &gt; S_1(\tau) )\\
   &amp;=   P( S_0(T_{0,i})^{\theta} &gt; S_1(\tau) \cup S_1(T_{1,j}) &gt; S_1(\tau) ) \\
   &amp;=   P( U_0 &gt; u_*^{1/\theta} \cup U_1 &gt; u_* )\\
   &amp;= 1 -  P( U_0 &lt; u_*^{1/\theta} \cap U_1 &lt; u_* ) \\
   &amp;= 1 - u_*^{1+\frac{1}{\theta}},
\end{aligned}
\]</span>
and dividing the numerator by the denominator finally gives the result that
<span class="math display">\[
P(T_{0,i} &lt; T_{1,j} \mid \min\{T_{0,i},T_{1,j}\} &lt; \min\{C_{0,i}, C_{1,j} \} ) = \frac{1}{1 + \theta}.
\]</span>
Maybe this was overkill. But it’s settled my mind a little. If someone tells me that the probabilistic index is <span class="math inline">\(\phi=1/(1+\theta)\)</span> (in the context of a proportional hazards model applied to a particular trial with administrative censoring), then I can imagine repeatedly selecting two patients at random, one from each arm. Out of the pairs where it is possible to establish who has better survival, the fraction of times that it is the patient from the experimental arm is <span class="math inline">\(\phi\)</span>.</p>
<p>[As an aside, I much prefer the interpretation <span class="math inline">\(S_1(t)=S_0(t)^\theta\)</span> as <em>the interpretation</em> of the hazard ratio. Looking at the above derivation, this is the more fundamental relationship. But, then again, there are several interpretations of the hazard ratio, each with pros and cons…would need a separate post.]</p>
</div>
<div id="link-with-concordance" class="section level2">
<h2>Link with concordance</h2>
<p>I can try to show an example using the <code>concordance()</code> function from <code>R</code>’s <code>survival</code> package. Firstly, I set up a data frame with some exponentially distributed survival data from a clinical trial. The control arm median is 12 months. The experimental arm median is 18 months. Recruitment is uniform over 12 months. The sample size of 5000 per arm is deliberately oversized for illustration purposes (so the point estimate of the hazard ratio is close to 0.66).</p>
<pre class="r"><code>library(dplyr)
library(survival)

set.seed(325)

df_ex &lt;- data.frame(rec = runif(10000, 0, 12),
                    y_star = c(rexp(5000, rate = log(2) / 12),
                               rexp(5000, rate = log(2) / 18)),
                    delta_star = 1,
                    trt = rep(c(&quot;0&quot;, &quot;1&quot;), each = 5000)) %&gt;% 
   mutate(delta = as.numeric(y_star + rec &lt; 18),
          y = pmin(y_star, 18 - rec))

head(df_ex)</code></pre>
<pre><code>##         rec    y_star delta_star trt delta         y
## 1 3.4275172 15.893085          1   0     0 14.572483
## 2 9.3391460  8.595456          1   0     1  8.595456
## 3 2.1307085  9.754036          1   0     1  9.754036
## 4 2.1295279  8.575436          1   0     1  8.575436
## 5 0.6061914  4.822211          1   0     1  4.822211
## 6 6.3240452  4.126706          1   0     1  4.126706</code></pre>
<p>The data frame contains two versions of the data set. <code>(y_star, delta_star)</code> is the survival time and event status (1=event; 0=censored) for the uncensored data set, assuming an infinite follow-up time. <code>(y, delta)</code> is the survival time and event status, assuming administrative censoring 18 months after the start of the study. I can quickly plot (without tidying up axis labels etc) the Kaplan Meier estimates for the two data sets:</p>
<pre class="r"><code>fit_inf &lt;- survfit(Surv(y_star, delta_star) ~ trt, data = df_ex)
fit_18 &lt;- survfit(Surv(y, delta) ~ trt, data = df_ex)

plot(fit_inf, col = 1:2)</code></pre>
<p><img src="/post/2021-12-14-notes-on-concordance_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>plot(fit_18, col = 1:2)</code></pre>
<p><img src="/post/2021-12-14-notes-on-concordance_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<p>I’ll start with the infinite follow-up data set, and fit a Cox model to confirm that the hazard ratio is essentially 0.66…</p>
<pre class="r"><code>cph_inf &lt;- coxph(Surv(y_star, delta_star) ~ trt, data = df_ex)
summary(cph_inf)$coef</code></pre>
<pre><code>##            coef exp(coef)   se(coef)         z     Pr(&gt;|z|)
## trt1 -0.4197819 0.6571902 0.02043946 -20.53781 9.891931e-94</code></pre>
<p>I could then estimate the <em>probabilistic index</em> as <span class="math inline">\(1/(1+0.66)= 0.6\)</span>.</p>
<p>Next I calculate the <em>concordance</em>…</p>
<pre class="r"><code>con_inf &lt;- concordance(cph_inf)
con_inf</code></pre>
<pre><code>## Call:
## concordance.coxph(object = cph_inf)
## 
## n= 10000 
## Concordance= 0.5505 se= 0.002813
## concordant discordant     tied.x     tied.y    tied.xy 
##   15025449    9974551   24995000          0          0</code></pre>
<p>We see that the concordance is 0.55. So <em>concordance</em> is not the same as the <em>probabilistic index</em>.</p>
<div id="what-is-concordance" class="section level3">
<h3>What is concordance?</h3>
<p>See <a href="https://cran.r-project.org/web/packages/survival/vignettes/concordance.pdf">this nice vignette</a> by Thernau &amp; Atkinson. The motivation for concordance usually comes from evaluating the performance of a risk prediction model, rather than quantifying treatment effect. It was proposed in this context by Frank Harrell <a href="https://jamanetwork.com/journals/jama/article-abstract/372568">in this 1982 paper</a>. The idea is that if I randomly select two patients from the entire population, what is the probability that the model prediction agrees with reality in terms of who has the longer survival time? Loosely speaking, concordance is defined as
<span class="math display">\[
P(\hat{T}_i &lt; \hat{T}_j \mid T_{i} &lt; T_{j}), 
\]</span>
and if there were no ties, this would be the same as
<span class="math display">\[
P(T_i &lt; T_j \mid \hat{T}_i &lt; \hat{T}_j).
\]</span>
It’s just saying that, out of all possible samples of size 2 from the whole population, how often does the actual ordering of events match the predicted ordering. However, to deal with ties, the definition of concordance is typically extended to
<span class="math display">\[
\begin{align}
\text{Concordance}:&amp;=P( \hat{T}_i &lt; \hat{T}_j \mid T_i &lt; T_j, \hat{T}_i\neq \hat{T}_j)P(\hat{T}_i \neq \hat{T}_j\mid T_i \neq T_j) + \frac{1}{2}P(\hat{T}_i = \hat{T}_j \mid T_i \neq T_j),\\
\end{align}
\]</span>
or, equivalently,
<span class="math display">\[
P(T_i &lt; T_j \mid \hat{T}_i &lt; \hat{T}_j, T_i \neq T_j)P(\hat{T}_i \neq \hat{T}_j \mid T_i \neq T_j) + \frac{1}{2}P(\hat{T}_i = \hat{T}_j \mid T_i \neq T_j).
\]</span></p>
<p>This is just saying that, out of all samples of size 2 from the whole population, if we discard samples with tied events, how often can we correctly predict from the model who will have the longer survival times (where if our model gives us tied predictions then we choose randomly / are correct with probability 0.5)?</p>
<p>In our clinical trial context, and for our first simulated data set where there are no ties in <span class="math inline">\(T\)</span> and no censoring, we have
<span class="math display">\[
\begin{align}
\text{Concordance}&amp;=P(T_i &lt; T_j \mid A_i = 0, A_j = 1)P(A_i \neq A_j) + \frac{1}{2}P(A_i = A_j)\\
&amp;= \text{Probabilistic Index } \times P(A_i \neq A_j) + \frac{1}{2}P(A_i = A_j).
\end{align}
\]</span></p>
<p>Since <span class="math inline">\(P(A_i = A_j)\)</span> is just telling us the allocation ratio, the Concordance and Probabilistic Index are essentially carrying the same information about the treatment effect. The Probabilistic Index is more natural for describing a treatment effect. Concordance is more natural for describing performance of a risk prediction model.</p>
<p>Going back to our example</p>
<pre class="r"><code>con_inf</code></pre>
<pre><code>## Call:
## concordance.coxph(object = cph_inf)
## 
## n= 10000 
## Concordance= 0.5505 se= 0.002813
## concordant discordant     tied.x     tied.y    tied.xy 
##   15025449    9974551   24995000          0          0</code></pre>
<p>the <code>concordance()</code> function has helpfully provided us with the number of <code>concordant</code>, <code>discordant</code> and <code>tied.x</code> pairs. From these, we can get empirical estimates for both the probabilistic index and the concordance. The total number of pairs is <code>choose(10000,2)</code> = 49,995,000. The number of pairs where both patients are on the same treatment arm is <code>2*choose(5000,2)</code> = 24,995,000. That’s what we see in <code>tied.x</code>. We have <code>5000 * 5000</code> = 25,000,000 pairs where one patient comes from each arm. Of these, we see that 15,025,449 are concordant, meaning that the survival of the patient on the experimental arm was longer than the survival of the patient on the control arm, and the rest were discordant. So an empirical estimate for the probabilistic index is 15,025,449 / 25,000,000 = 0.60, which agrees with our theoretical result above. And the empirical estimate for the concordance is</p>
<p><span class="math display">\[
 \frac{15,025,449}{25,000,000}\times\frac{25,000,000}{49,995,000} + 0.5 \times \frac{24,995,000}{49,995,000} = 0.550514,
\]</span>
which is exactly what we see.</p>
<p>Now let’s move on to the censored data set…</p>
<pre class="r"><code>cph_18 &lt;- coxph(Surv(y, delta) ~ trt, data = df_ex)
summary(cph_18)$coef</code></pre>
<pre><code>##            coef exp(coef)   se(coef)        z     Pr(&gt;|z|)
## trt1 -0.3942244 0.6742028 0.03099125 -12.7205 4.549172e-37</code></pre>
<p>In this case everything looks the same…</p>
<pre class="r"><code>con_18 &lt;- concordance(cph_18)
con_18</code></pre>
<pre><code>## Call:
## concordance.coxph(object = cph_18)
## 
## n= 10000 
## Concordance= 0.5495 se= 0.004008
## concordant discordant     tied.x     tied.y    tied.xy 
##    9023362    6051734   14914532          0          0</code></pre>
<p>except that all pairs where it is impossible to establish for certain which patient had the longer survival time have been removed from consideration, and hence we see lower numbers of <code>concordant</code>, <code>discordant</code> and <code>tied.x</code> pairs. An empirical estimate of the probabilistic index, which remember I defined as
<span class="math display">\[P(T_{0,i} &lt; T_{1,j} \mid \text{It&#39;s possible to know given censoring})\]</span>
is <code>concordant</code> / (<code>concordant</code> + <code>discordant</code>) = 9023362 / (9023362 + 6051734) = 0.60, mathching the theoretical result.</p>
<p>For the concordance, I also need to modify the definition. Let <span class="math inline">\(E_{i,j}\)</span> denote the event “It’s possible to know which of <span class="math inline">\(T_i\)</span> and <span class="math inline">\(T_j\)</span> happens first”. Then</p>
<p><span class="math display">\[
\text{Concordance}:=P(T_i &lt; T_j \mid \hat{T}_i &lt; \hat{T}_j, T_i \neq T_j,E_{i,j})P(\hat{T}_i \neq \hat{T}_j \mid T_i \neq T_j,E_{i,j}) + \frac{1}{2}P(\hat{T}_i = \hat{T}_j \mid T_i \neq T_j,E_{i,j}).
\]</span>
I can estimate this empirically as</p>
<p><span class="math display">\[
 \frac{9023362}{9023362 + 6051734}\times\frac{9023362 + 6051734}{9023362 + 6051734 + 14914532} + 0.5 \times \frac{14914532}{9023362 + 6051734 + 14914532} = 0.5495443,
\]</span></p>
<p>which is exactly what we see.</p>
</div>
</div>
<div id="further-topics" class="section level2">
<h2>Further Topics</h2>
<p>I wanted to explain a bit more about</p>
<ul>
<li>standard errors for concordance. Both for empirical estimates. And using the reationship with the hazard ratio.</li>
<li>alternative weighted versions of concordance (see the <a href="https://cran.r-project.org/web/packages/survival/vignettes/concordance.pdf">vignette</a>)</li>
<li>a non-proportional hazards example.</li>
</ul>
<p>But I’ve run out of steam. Maybe I’ll come back to it another time.</p>
</div>
<div id="p.s.-standard-errors" class="section level2">
<h2>P.S. standard errors</h2>
<p>Follows (<a href="https://cran.r-project.org/web/packages/survival/vignettes/concordance.pdf" class="uri">https://cran.r-project.org/web/packages/survival/vignettes/concordance.pdf</a>) closely.</p>
<p>Let’s take the same example as before, except we reduce the sample size from 10,000 to 400 so that it makes sense to worry about standard errors.</p>
<pre class="r"><code>library(dplyr)
library(survival)

set.seed(325)

df_ex &lt;- data.frame(rec = runif(400, 0, 12),
                    y_star = c(rexp(200, rate = log(2) / 12),
                               rexp(200, rate = log(2) / 18)),
                    delta_star = 1,
                    trt = rep(c(&quot;0&quot;, &quot;1&quot;), each = 200)) %&gt;% 
   mutate(delta = as.numeric(y_star + rec &lt; 18),
          y = pmin(y_star, 18 - rec))

head(df_ex)</code></pre>
<pre><code>##         rec    y_star delta_star trt delta         y
## 1 3.4275172 39.246498          1   0     0 14.572483
## 2 9.3391460 25.012807          1   0     0  8.660854
## 3 2.1307085  1.414864          1   0     1  1.414864
## 4 2.1295279 12.747489          1   0     1 12.747489
## 5 0.6061914 17.157924          1   0     1 17.157924
## 6 6.3240452 10.810010          1   0     1 10.810010</code></pre>
<pre class="r"><code>fit_inf &lt;- survfit(Surv(y_star, delta_star) ~ trt, data = df_ex)
fit_18 &lt;- survfit(Surv(y, delta) ~ trt, data = df_ex)

plot(fit_inf, col = 1:2)</code></pre>
<p><img src="/post/2021-12-14-notes-on-concordance_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>plot(fit_18, col = 1:2)</code></pre>
<p><img src="/post/2021-12-14-notes-on-concordance_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<div id="confidence-interval-for-probabilistic-index-using-the-relationship-phi-1-1-theta" class="section level3">
<h3>Confidence interval for Probabilistic Index using the relationship <span class="math inline">\(\phi = 1 / (1 + \theta)\)</span></h3>
<pre class="r"><code>## Infinite follow-up
cph_inf &lt;- coxph(Surv(y_star, delta_star) ~ trt, data = df_ex)

## Point estimate
1 / (1 + exp(cph_inf$coefficients))</code></pre>
<pre><code>##      trt1 
## 0.5793188</code></pre>
<pre class="r"><code>## CI
rev(1 / (1 + exp(confint(cph_inf))))</code></pre>
<pre><code>## [1] 0.5299843 0.6271182</code></pre>
<pre class="r"><code>## 18 month max follow-up
cph_18 &lt;- coxph(Surv(y, delta) ~ trt, data = df_ex)

## Point estimate
1 / (1 + exp(cph_18$coefficients))</code></pre>
<pre><code>##      trt1 
## 0.5730088</code></pre>
<pre class="r"><code>## CI
rev(1 / (1 + exp(confint(cph_18))))</code></pre>
<pre><code>## [1] 0.4958763 0.6467470</code></pre>
</div>
<div id="standard-error-of-concordance-empirical" class="section level3">
<h3>Standard error of concordance (empirical)</h3>
<p>The standard error for the empirical estimator of the concordance can be calculated <a href="https://www.mayo.edu/research/documents/bsi-techreport-85/doc-20433003">based on the nice observation by Therneau and Watson</a> that a standardized version of this estimator is equal to the score statistic from a Cox model with a time-dependent covariate <span class="math inline">\(n(t_i)r_i(t_i)\)</span>, where <span class="math inline">\(n(t_i)\)</span> and <span class="math inline">\(r_i(t_i)\)</span> are defined as ” the number of subjects still at risk at time t” and “the rank of <span class="math inline">\(x_i\)</span> among all those still at risk at time <span class="math inline">\(t\)</span>”, respectively. I found it quite difficult to get my head around the <em>exact</em> definition of <span class="math inline">\(n(t_i)\)</span> and <span class="math inline">\(r_i(t_i)\)</span>, and also to understand why there is this equivalence. To avoid that pain again, I’ll now try to explain in excessive detail…</p>
<p>Starting with the empirical estimate for concordance:</p>
<p><span class="math display">\[ \tilde{C} = \frac{\sum_{\text{pairs}: E_{i,j}\cap (T_i &lt; T_j)} I(\hat{T}_i&lt;\hat{T}_j)+ 0.5I(\hat{T}_i&lt;\hat{T}_j)}{\sum_{\text{pairs}: E_{i,j}\cap (T_i &lt; T_j) } I(\hat{T}_i&lt;\hat{T}_j) + I(\hat{T}_i&gt;\hat{T}_j) + I(\hat{T}_i=\hat{T}_j)}\]</span></p>
<p>where <span class="math inline">\(E_{i,j}\)</span> is the event that it’s possible to establish which of <span class="math inline">\(T_i\)</span> and <span class="math inline">\(T_j\)</span> is larger given censoring, we can then rearrange:</p>
<p><span class="math display">\[ \left\lbrace \sum_{\text{pairs}: E_{i,j}\cap (T_i &lt; T_j)} 1 \right\rbrace \left( 2\tilde{C}-1 \right) = \sum_{\text{pairs}: E_{i,j}\cap (T_i &lt; T_j)} I(\hat{T}_i&lt;\hat{T}_j) - I(\hat{T}_i&gt;\hat{T}_j) =: U.\]</span></p>
<p>The next step is to recognize that we can sum up the terms in <span class="math inline">\(U\)</span> in a particular order:</p>
<p><span class="math display">\[ U = \sum_i \sum_{j: E_{i,j} \cap (T_j &gt; T_i)} \text{sign}(\hat{T}_j - \hat{T}_i)\]</span>
where <span class="math inline">\(\text{sign}(z)\)</span>=-1,0 or 1, depending if <span class="math inline">\(z\)</span> is <span class="math inline">\(&lt;0\)</span>, <span class="math inline">\(=0\)</span> or <span class="math inline">\(&gt;0\)</span>.</p>
<p>For a pair <span class="math inline">\((i,j)\)</span> to satisfy <span class="math inline">\(E_{i,j} \cap (T_j &gt; T_i)\)</span>, we firstly need the survival time <span class="math inline">\(T_i\)</span> to be uncensored. Also, we need patient <span class="math inline">\(j\)</span> to be in the at-risk set at time <span class="math inline">\(T_i\)</span>. This is sufficient to satisfy the condition. So we have</p>
<p><span class="math display">\[U = \sum_i \delta_i \sum_{j: j\neq i,j\in R(T_i) } \text{sign}(\hat{T}_j - \hat{T}_i),\]</span></p>
<p>where <span class="math inline">\(\delta_i\)</span> is an indicator that patient <span class="math inline">\(i\)</span> has an event, and <span class="math inline">\(R\)</span> denotes the risk set. The same expression is found in <a href="https://www.mayo.edu/research/documents/bsi-techreport-85/doc-20433003">Appendix A of Therneau and Watson</a>. At this point, we can introduce the more precise definitions for <span class="math inline">\(r_i(t_i)\)</span> and <span class="math inline">\(n(t_i)\)</span>:</p>
<p><span class="math display">\[r_i(t_i):= \frac{1}{n(t_i)}\sum_{j: j\neq i,j\in R(T_i)} \left[ I(\hat{T}_i &lt; \hat{T}_j) + \frac{1}{2}I(\hat{T}_i = \hat{T}_j)\right], \]</span>
where <span class="math inline">\(n(t_i):= |j: j\neq i,j\in R(T_i)|\)</span>, i.e., the size of the risk set (excluding <span class="math inline">\(i\)</span> itself). Next (following T&amp;W),</p>
<p><span class="math display">\[
\begin{align}
 r_i(t_i) &amp;= \frac{1}{n(t_i)}\sum_{j: j\neq i,j\in R(T_i)} \left[ I(\hat{T}_i &lt; \hat{T}_j) + \frac{1}{2}I(\hat{T}_i = \hat{T}_j)\right]\\
 &amp;= \frac{1}{n(t_i)}\sum_{j: j\neq i,j\in R(T_i)} \left[ \text{sign}(\hat{T}_j - \hat{T}_i)  + 1   \right] /2\\
 &amp;= \frac{1}{2} +  \frac{1}{n(t_i)}\sum_{j: j\neq i,j\in R(T_i)}  \frac{\text{sign}(\hat{T}_j - \hat{T}_i)}{2}
\end{align}
\]</span></p>
<p>and therefore</p>
<p><span class="math display">\[U = \sum_i 2\delta_i n(t_i)\{r_i(t_i) - 1 / 2\}\]</span></p>
<p>To see that this is equivalent to a Cox model, we must further recognize that <span class="math inline">\(\bar{r} = 1/2\)</span>, where <span class="math inline">\(\bar{r}\)</span> is the average of the <span class="math inline">\(r_i\)</span> across all <span class="math inline">\(i\)</span> at risk at time <span class="math inline">\(t_i\)</span> (this is because the <span class="math inline">\(j\neq i\)</span> terms cancel each other out), and finally write down the partial likelihood from the Cox model with a time-dependent covariate <span class="math inline">\(z(t)\)</span>:</p>
<p><span class="math display">\[\sum_i \delta_i \left[ z_i(t_i) - \frac{\sum_{j \in R(t_i)} z_j(t_i) \exp\left[ z_j(t_i)\beta \right]}{\exp\left[ z_j(t_i)\beta \right]} \right] \mid_{\beta = 0} = \sum_i \delta_i \left[ z_i(t_i) - \bar{z}(t_i)\right],\]</span></p>
<p>observing the equivalence between this expression and the expression for <span class="math inline">\(U\)</span> when <span class="math inline">\(z_i(t_i) =2 n(t_i)r_i(t_i)\)</span>.</p>
<p>A nice consequence of using the Cox model is that we can write down the variance of this statistic under the null hypothesis (see, e.g., page 128 of <a href="https://www4.stat.ncsu.edu/~dzhang2/st745/chap6.pdf" class="uri">https://www4.stat.ncsu.edu/~dzhang2/st745/chap6.pdf</a>):</p>
<p><span class="math display">\[ \sum_i \delta_i \left[ \sum_{j \in R(t_i)} \frac{z_j(t_i)^2}{n(t_i)} - \bar{z}(t_i)^2  \right].\]</span>
In principle, I think this is enough to be able to calculate the variance for the empirical estimate of concordance for a general Cox model, but I can’t be bothered any more to actually go through a more complicated example (i.e. a Cox model with more than one variable).</p>
<p>In the context of just two predictions (e.g. in a simple RCT with <span class="math inline">\(A=0\)</span> and <span class="math inline">\(A=1\)</span>), the score statistic reduces to the Gehan-Wilcoxon statistic (this is also shown in the appendix of <a href="https://www.mayo.edu/research/documents/bsi-techreport-85/doc-20433003" class="uri">https://www.mayo.edu/research/documents/bsi-techreport-85/doc-20433003</a>)</p>
<p><span class="math display">\[ U= \sum_k n_k (d_{1,k} - \frac{n_{1,k}}{n_1}) \]</span></p>
<p>with variance</p>
<p><span class="math display">\[\text{var}({U}) = \sum_kn_{k}^2 \times\text{var}\left(d_{1,k} - \frac{n_{1,k}}{n_1}\right)\]</span>.</p>
<p>And from these formulas I can reconstruct the estimate of the variance for our example.</p>
<p>The terms <span class="math inline">\(\{2r_i(t_i) - 1\}\)</span> are guaranteed to be between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span>, and they are provided in the <code>rank</code> column by <code>survival::concordance</code>, if we explicitly ask for it:</p>
<pre class="r"><code>con_inf &lt;- concordance(cph_inf, ranks = TRUE)
head(con_inf$ranks)</code></pre>
<pre><code>##           time       rank timewt casewt  variance
## 98  0.01382162  0.5012531    399      1 0.2500000
## 313 0.06709051 -0.5000000    398      1 0.2499984
## 257 0.09001529 -0.5012594    397      1 0.2500000
## 40  0.12598446  0.5000000    396      1 0.2499984
## 395 0.14877580 -0.5012658    395      1 0.2500000
## 262 0.18041986 -0.5025381    394      1 0.2499984</code></pre>
<pre class="r"><code>tail(con_inf$ranks)</code></pre>
<pre><code>##          time       rank timewt casewt  variance
## 332  98.80991 -0.1666667      6      1 0.1224490
## 348  99.66819 -0.2000000      5      1 0.1388889
## 164 108.75980  1.0000000      4      1 0.1600000
## 368 109.71749  0.0000000      3      1 0.0000000
## 205 111.79013  0.0000000      2      1 0.0000000
## 396 113.71013  0.0000000      1      1 0.0000000</code></pre>
<p>Next I print out the concordance again…</p>
<pre class="r"><code>con_inf</code></pre>
<pre><code>## Call:
## concordance.coxph(object = cph_inf, ranks = TRUE)
## 
## n= 400 
## Concordance= 0.5331 se= 0.01436
## concordant discordant     tied.x     tied.y    tied.xy 
##      22640      17360      39800          0          0</code></pre>
<p>…and show I can reproduce it from the formula above for <span class="math inline">\(U\)</span> based on <span class="math inline">\(r\)</span> and <span class="math inline">\(n\)</span> (79800 is the total number of pairs)…</p>
<pre class="r"><code>(sum(con_inf$ranks[,&quot;rank&quot;] * con_inf$ranks[,&quot;timewt&quot;]) / 79800 + 1) / 2</code></pre>
<pre><code>## [1] 0.5330827</code></pre>
<p>…and I can reproduce the variance for the specific case of just two groups</p>
<pre class="r"><code>con_inf$cvar</code></pre>
<pre><code>## [1] 0.0002092043</code></pre>
<pre class="r"><code>(sum((con_inf$ranks[&quot;timewt&quot;] + 1) ^2 * con_inf$ranks[&quot;variance&quot;])) / (79800^2) / 4</code></pre>
<pre><code>## [1] 0.0002092043</code></pre>
</div>
<div id="still-to-do" class="section level3">
<h3>Still to do</h3>
<ul>
<li>jacknife estimate of variance</li>
<li>weighted version of concordance</li>
<li>non-proportional hazards</li>
</ul>
<p>I don’t think I’ll get round to this now. Refer to <a href="https://www.mayo.edu/research/documents/bsi-techreport-85/doc-20433003" class="uri">https://www.mayo.edu/research/documents/bsi-techreport-85/doc-20433003</a></p>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>De Neve, Jan, and Thomas A. Gerds. “On the interpretation of the hazard ratio in Cox regression.” Biometrical Journal 62.3 (2020): 742-750.</p>
<p>Harrell, Frank E., et al. “Evaluating the yield of medical tests.” Jama 247.18 (1982): 2543-2546.</p>
<p>Therneau, Terry, and Elizabeth Atkinson. “1 The concordance statistic.” (2020).</p>
</div>

    </div>

    


















  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu3ad799765e91f69a41f3acc2fc665a63_309343_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Dominic Magirr</a></h5>
      <h6 class="card-subtitle">Medical Statistician</h6>
      <p class="card-text">Interested in the design, analysis and interpretation of clinical trials.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/dominic-magirr-87666b12b/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.co.uk/citations?user=obri2xMAAAAJ&amp;hl=en" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/dominicmagirr" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="/files/cv.pdf" >
        <i class="ai ai-cv"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.01f68d44d80310e669a1731b68a35481.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
